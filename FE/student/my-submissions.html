<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Submissions - SkillRank</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body class="bg-slate-50 text-slate-900">
    <nav id="navbar" class="fixed w-full z-50 glass-effect border-b border-slate-200"></nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-12">
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">My Submissions</h1>
            <p class="text-slate-600">Track the status of all your task submissions</p>
        </div>

        <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-slate-50 border-b border-slate-200">
                        <tr>
                            <th class="text-left px-6 py-4 text-sm font-semibold text-slate-600">Task</th>
                            <th class="text-left px-6 py-4 text-sm font-semibold text-slate-600">Company</th>
                            <th class="text-left px-6 py-4 text-sm font-semibold text-slate-600">Date</th>
                            <th class="text-left px-6 py-4 text-sm font-semibold text-slate-600">Status</th>
                            <th class="text-left px-6 py-4 text-sm font-semibold text-slate-600">Score</th>
                            <th class="text-left px-6 py-4 text-sm font-semibold text-slate-600">Feedback</th>
                        </tr>
                    </thead>
                    <tbody id="submissions-body" class="divide-y divide-slate-100">
                        <tr><td colspan="6" class="px-6 py-12 text-center text-slate-500">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="/assets/js/api.js"></script>
    <script src="/assets/js/navbar.js"></script>
    <script src="/assets/js/utils.js"></script>
    <script>
        if (!requireAuth('student')) throw new Error('Not authorized');

        async function loadSubmissions() {
            try {
                const submissions = await apiGet('/submissions/mine');
                const tbody = document.getElementById('submissions-body');

                if (submissions.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-12 text-center text-slate-500">
                        No submissions yet. <a href="/browse-tasks" class="text-blue-600 hover:underline">Browse tasks</a> to get started!
                    </td></tr>`;
                    return;
                }

                tbody.innerHTML = submissions.map(s => `
                    <tr class="table-row">
                        <td class="px-6 py-4">
                            <a href="/student/task-detail?id=${s.task_id}" class="font-medium text-blue-600 hover:underline">${s.task_title}</a>
                        </td>
                        <td class="px-6 py-4 text-slate-600">${s.company_name}</td>
                        <td class="px-6 py-4 text-slate-600 text-sm">${formatDate(s.submitted_at)}</td>
                        <td class="px-6 py-4">${statusBadge(s.status)}</td>
                        <td class="px-6 py-4">${s.score !== null ? scoreBar(s.score) : '<span class="text-slate-400">-</span>'}</td>
                        <td class="px-6 py-4 text-sm text-slate-600 max-w-xs truncate">${s.feedback || '-'}</td>
                    </tr>
                `).join('');
            } catch (err) {
                document.getElementById('submissions-body').innerHTML =
                    '<tr><td colspan="6" class="px-6 py-12 text-center text-red-500">Failed to load submissions</td></tr>';
            }
        }

        loadSubmissions();
    </script>
</body>
</html>
